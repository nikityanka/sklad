# Управление складом с использованием gRPC (Выполнил Комиссаров Никита, гр. 2991)

## Описание проекта

Этот проект представляет собой систему управления складом, реализованную с использованием протокола gRPC. Система состоит из сервера и клиента, которые взаимодействуют для выполнения операций с продуктами на складе. Основные функции включают:

- Добавление новых продуктов.
- Получение информации о продукте по его идентификатору (ID).
- Обновление количества запасов продукта.
- Удаление продукта из системы.
- Получение списка всех продуктов.
- Мониторинг низких запасов с помощью потоковых уведомлений (алертов).

**Сценарий использования:**\
Система может быть применена в небольшом интернет-магазине для управления запасами товаров. Например, менеджер магазина может добавлять новые товары в систему, обновлять их количество на складе и получать автоматические уведомления, если запасы какого-либо товара опускаются ниже заданного порога (например, 10 единиц). Это помогает вовремя пополнять склад и избегать ситуаций, когда товар заканчивается.

**Структура директорий:**

```
├── proto/                   # Прото-файлы
│   └── inventory.proto
├── server.py                # gRPC сервер 
├── client.py                # gRPC клиент 
├── inventory_pb2.py         # Сгенерированные классы
├── inventory_pb2_grpc.py    # Сгенерированные gRPC классы
├── storage.json             # Файл хранилища (автоматически создается)
└── README.md                # Документация
```

---

## Установка и запуск

### Установка зависимостей

1. Убедитесь, что у вас установлен Python версии 3.7 или выше.

2. Установите необходимые зависимости:

   ```bash
   pip install grpc
   ```

3. Если файлы `inventory_pb2.py` и `inventory_pb2_grpc.py` отсутствуют, сгенерируйте их из файла `proto/inventory.proto`:

   ```bash
   python -m grpc_tools.protoc -Iproto --python_out=. --grpc_python_out=. proto/inventory.proto
   ```

### Запуск сервера

1. Перейдите в корневую директорию проекта:

   ```bash
   cd C:\...\sklad
   ```

2. Запустите сервер:

   ```bash
   python server.py
   ```

   Сервер будет запущен на порту `50051` и начнёт ожидать запросы от клиента. В терминале появится сообщение:

   ```
   Сервер запущен на порту 50051
   ```

### Запуск клиента

1. Откройте новый терминал, активируйте виртуальную среду (если она не активна), и перейдите в корневую директорию проекта:

   ```bash
   cd C:\...\sklad
   ```

2. Запустите клиент:

   ```bash
   python client.py
   ```

   Клиент подключится к серверу, выполнит тестовые операции (добавление, обновление, удаление продуктов и т.д.) и начнёт мониторинг уведомлений о низких запасах. Для завершения работы клиента нажмите `Ctrl+C`.

---

## Примеры запросов и ожидаемые ответы

Ниже приведены примеры операций, которые выполняет клиент через gRPC-запросы к серверу, и ожидаемые ответы. Они основаны на текущем состоянии данных в файле `storage.json` и логике, реализованной в `client.py` и `server.py`.

### 1. Добавление продукта

Клиент пытается добавить новый продукт, например, "Смартфон" с ID `p2` и количеством 15.

**Запрос:**

```python
stub.AddProduct(inventory_pb2.Product(id="p2", name="Смартфон", quantity=15))
```

**Ожидаемый ответ:**

```
Добавлен продукт Смартфон: Успех
```

Если продукт с ID `p2` уже существует, клиент получит:

```
Продукт Смартфон уже существует: 15 шт.
```

### 2. Получение информации о продукте

Клиент запрашивает данные о продукте с ID `p1` (Ноутбук).

**Запрос:**

```python
stub.GetProduct(inventory_pb2.ProductRequest(id="p1"))
```

**Ожидаемый ответ:**

```
Получен продукт: Ноутбук, Количество: 10
```

Если продукта с указанным ID нет:

```
Ошибка получения продукта p1: Not found
```

### 3. Обновление запасов

Клиент уменьшает количество "Ноутбука" (ID `p1`) на 5 единиц.

**Запрос:**

```python
stub.UpdateStock(inventory_pb2.StockUpdateRequest(product_id="p1", delta=-5))
```

**Ожидаемый ответ:**

```
Запасы p1 обновлены (-5)
```

Если новое количество становится отрицательным (например, при попытке уменьшить на 50):

```
Ошибка обновления запасов p1: Invalid argument
```

### 4. Получение списка продуктов

Клиент запрашивает список всех продуктов на складе.

**Запрос:**

```python
stub.ListProducts(inventory_pb2.Empty())
```

**Ожидаемый ответ (на основе текущего** `storage.json`**):**

```
Текущий список продуктов:
- Ноутбук (ID: p1): 10 шт.
- Планшет (ID: p3): 2 шт.
```

### 5. Удаление продукта

Клиент удаляет продукт с ID `p2`.

**Запрос:**

```python
stub.RemoveProduct(inventory_pb2.ProductRequest(id="p2"))
```

**Ожидаемый ответ:**

```
Продукт p2 успешно удален
```

Если продукта с ID `p2` нет:

```
Продукт p2 не найден
```

### 6. Мониторинг низких запасов

Клиент запускает поток для получения уведомлений о продуктах, у которых количество ниже порога (10 единиц).

**Запрос:**

```python
for alert in stub.StreamStockAlerts(inventory_pb2.AlertRequest(threshold=10)):
    print(f"[ALERT] Низкий запас: {alert.product_name} (ID: {alert.product_id}), Осталось: {alert.current_quantity}")
```

**Ожидаемый ответ:**

```
[ALERT] Низкий запас: Планшет (ID: p3), Осталось: 2
```

Уведомления отправляются только один раз для каждого продукта, если его количество ниже порога. Сервер проверяет состояние каждые 3 секунды.

---
